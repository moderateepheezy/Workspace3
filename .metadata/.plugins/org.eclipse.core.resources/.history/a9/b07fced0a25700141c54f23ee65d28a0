package com.example.chatapp;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.parse.LogInCallback;
import com.parse.ParseException;
import com.parse.ParseUser;
import com.parse.SignUpCallback;

public class LoginActivity extends Activity {
	Button loginButton;
	Button signupButton;
	EditText usernameField;
	EditText passwordFeild;
	String username;
	String password;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_login);
        
        loginButton =(Button)findViewById(R.id.loginButton);
        signupButton = (Button)findViewById(R.id.signupButton);
        usernameField = (EditText)findViewById(R.id.loginUsername);
        passwordFeild = (EditText)findViewById(R.id.loginPassword);
        
        loginButton.setOnClickListener(new View.OnClickListener() {
			
			@Override
			public void onClick(View view) {
				username = usernameField.getText().toString();
				password = passwordFeild.getText().toString();
				
				ParseUser.logInInBackground(username, password, new LogInCallback() {
					
					@Override
					public void done(ParseUser user, ParseException e) {
						if(user != null){
							final Intent intent = new Intent(getApplicationContext(), ListUserActivity.class);
							final Intent serviceIntent = new Intent(getApplicationContext(), MessageService.class);
							startService(serviceIntent);
							startActivity(intent);
						}
						else{
							Toast.makeText(getApplicationContext(), "There was an error login in!", Toast.LENGTH_LONG).show();
						}
					}
				});
			}
		});
        
        signupButton.setOnClickListener(new View.OnClickListener() {
			
			@Override
			public void onClick(View view) {
				username = usernameField.getText().toString();
				password = passwordFeild.getText().toString();
				
				ParseUser  newUser = new ParseUser();
				newUser.setUsername(username);
				newUser.setPassword(password);
				
				newUser.signUpInBackground(new SignUpCallback() {
					
					@Override
					public void done(ParseException e) {
						if(e == null){
							final Intent intent = new Intent(getApplicationContext(), ListUserActivity.class);
							final Intent serviceIntent = new Intent(getApplicationContext(), MessageService.class);
							startService(serviceIntent);
							startActivity(intent);
						}
						else{
							Toast.makeText(getApplicationContext(), "There was an error signing in", Toast.LENGTH_SHORT).show();
						}
					}
				});
			}
		});
    }
    
    @Override
    protected void onDestroy() {
    	stopService(new Intent(this, MessageService.class));
    	super.onDestroy();
    }

}
